<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Guide on 奇迹之流WonderfloW</title>
    <link>https://wonderflow.info/tags/guide/</link>
    <description>Recent content in Guide on 奇迹之流WonderfloW</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Tue, 01 Jul 2014 06:05:03 +0000</lastBuildDate>
    <atom:link href="https://wonderflow.info/tags/guide/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Cloud Foundry 运维入门</title>
      <link>https://wonderflow.info/posts/2014/07/01/cloud-foundry-e8bf90e7bbb4e585a5e997a8/</link>
      <pubDate>Tue, 01 Jul 2014 06:05:03 +0000</pubDate>
      <guid>https://wonderflow.info/posts/2014/07/01/cloud-foundry-e8bf90e7bbb4e585a5e997a8/</guid>
      <description>&lt;p&gt;@(CF V2相关)[guide]&lt;/p&gt;&#xA;&lt;p&gt;之前写过一个&lt;a href=&#34;http://wonderflow.info/archives/590&#34;&gt;Guide for Cloud Foundry New Teamer&lt;/a&gt;。不过似乎已经有些过时，那会实验室主要是针对的CF v1进行的研究，现在已经全面进入V2时代了。所以更新一下关于CloudFoundry运维的一些内容。如果有时间也可再回头看看V1的那个帖子，希望能有所帮助。&lt;/p&gt;&#xA;&lt;h1 id=&#34;部署&#34;&gt;&#xA;    部署&lt;a class=&#34;hash-link&#34; href=&#34;#%e9%83%a8%e7%bd%b2&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;关于部署，目前使用的工具一般有两种，&lt;a href=&#34;http://docs.cloudfoundry.org/bosh/&#34;&gt;BOSH&lt;/a&gt;和&lt;a href=&#34;https://github.com/yudai/cf_nise_installer&#34;&gt;cf_nise_installer&lt;/a&gt;。BOSH适用于集群安装，cf_nise_installer适用于单节点安装。下面主要以cf_nise_installer的安装方法为主描述部署的运维流程。&lt;/p&gt;&#xA;&lt;p&gt;cf_nise_installer实际上就是一大堆shell脚本建立起来的项目，对shell脚本熟悉的人打开上面的链接就可以看到整个部署的流程。&lt;/p&gt;&#xA;&lt;p&gt;第一步就是安装运行环境。&lt;/p&gt;&#xA;&lt;p&gt;通过cf_nise_installer中的这段&lt;a href=&#34;https://github.com/yudai/cf_nise_installer/blob/master/scripts/install.sh&#34;&gt;install.sh&lt;/a&gt;脚本的代码我们可以看到它的安装流程如下：&lt;/p&gt;&#xA;&lt;p&gt;{% codeblock %}&#xA;./scripts/install_ruby.sh&#xA;source ~/.profile&#xA;./scripts/clone_nise_bosh.sh&#xA;./scripts/clone_cf_release.sh&#xA;./scripts/install_environemnt.sh&#xA;./scripts/install_cf_release.sh&lt;/p&gt;&#xA;&lt;p&gt;{% endcodeblock %}&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;安装ruby：cf_nise_installer使用的是rbenv这个ruby安装工具。同样比较有名的ruby安装工具还有rvm，这两个工具任选一个即可，如果是使用某个固定的ruby版本的话，建议使用&lt;a href=&#34;http://scoop.simplyexcited.co.uk/2012/03/02/install-ruby-1-9-3-p125-from-source/&#34;&gt;源码安装&lt;/a&gt;。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;下载&lt;a href=&#34;https://github.com/nttlabs/nise_bosh&#34;&gt;nise_bosh&lt;/a&gt;项目：实际上cf_nise_installer是基于nise_bosh的一个脚本，真正执行安装的就是nise_bosh这个项目。nise_bosh是一个基于bosh的项目，把bosh关于IaaS层的内容去除，保留了虚拟机上组建安装的内容。所以使用nisebosh无需IaaS层的API支持，只需要虚拟机即可安装。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;制作cf_release：cf_release是cf源码经过编译后的内容。从github上clone下来的&lt;a href=&#34;https://github.com/cloudfoundry/cf-release&#34;&gt;cf_release&lt;/a&gt;，checkout到指定版本&lt;a href=&#34;http://wonderflow.info/wp-content/uploads/2013/08/chinese_git_pocket_wonderflow.pdf&#34;&gt;git使用简易入门&lt;/a&gt;，然后执行&lt;code&gt;git submodule update --init --recursive&lt;/code&gt;把子模块submodule下载下来，再执行&lt;code&gt;bosh create release&lt;/code&gt;命令，就可以得到一个完整的cf_release，当然，这里面又是漫长的下载。实验室已经制作了几个常用的cf_release版本，在&lt;a href=&#34;http://10.10.103.102/releases/&#34;&gt;内网&lt;/a&gt;可以下载。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;安装环境，这里执行的其实就是&lt;a href=&#34;https://github.com/nttlabs/nise_bosh/blob/master/bin/init&#34;&gt;nise_bosh/bin/init&lt;/a&gt;这个脚本，打开就可以看到下载了很多基础的运行时环境，以及监控使用的monit工具。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;安装cf组件。到这里就是真正的安装cf组件了。安装的命令很短，东西都在配置文件里面了。可以打开&lt;a href=&#34;https://github.com/yudai/cf_nise_installer/blob/master/manifests/template.yml&#34;&gt;manifests/template&lt;/a&gt;查看一下。默认的域名都设置成了&lt;code&gt;192.168.10.10.xip.io&lt;/code&gt;，执行&lt;a href=&#34;https://github.com/yudai/cf_nise_installer/blob/master/scripts/generate_deploy_manifest.sh&#34;&gt; generate_deploy_manifest.sh&lt;/a&gt;脚本可以更改域名和密码，不过需要在环境变量中导入&lt;code&gt;export NISE_DOMAIN=[你的域名]&lt;/code&gt; &lt;code&gt;export NISE_PASSWORD=[你的密码]&lt;/code&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;关于域名&lt;/strong&gt; 架设本地域名解析服务器，如bind9之类的，然后在/etc/resolv.conf下面的nameserver加上本地域名解析服务器IP即可。在域名解析服务器上加上一条域名对应组件机器的IP就可以顺利用域名访问集群了。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;关于一次正常的连接&lt;/strong&gt; [用户访问域名]-&amp;gt;[域名解析服务器解析出IP]-&amp;gt;[Haproxy组件收到请求转发]-&amp;gt;[Gorouter接到请求]-&amp;gt;[DEA/CC最终处理]&lt;/p&gt;&#xA;&lt;h1 id=&#34;集群使用&#34;&gt;&#xA;    集群使用&lt;a class=&#34;hash-link&#34; href=&#34;#%e9%9b%86%e7%be%a4%e4%bd%bf%e7%94%a8&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h1&gt;&lt;h2 id=&#34;安装cf命令行工具&#34;&gt;&#xA;    安装CF命令行工具&lt;a class=&#34;hash-link&#34; href=&#34;#%e5%ae%89%e8%a3%85cf%e5%91%bd%e4%bb%a4%e8%a1%8c%e5%b7%a5%e5%85%b7&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;下载并安装&lt;a href=&#34;https://github.com/cloudfoundry/cli/releases&#34;&gt;cf_cli&lt;/a&gt; &lt;code&gt;dpkg -i ***.deb&lt;/code&gt;。新版cf命令行的命令有比较大的变化，可以使用&lt;code&gt;cf --help&lt;/code&gt;看一下。&lt;/p&gt;&#xA;&lt;h2 id=&#34;制作离线java_buildpack&#34;&gt;&#xA;    制作离线java_buildpack&lt;a class=&#34;hash-link&#34; href=&#34;#%e5%88%b6%e4%bd%9c%e7%a6%bb%e7%ba%bfjava_buildpack&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;cloudfoundry从V168以后，就不在cf-release里面放入buildpack了，也就是云应用的运行时环境。每次应用上传都要去pivotal的网站上下buildpack，速度比较慢，所以就涉及到了制作离线的buildpack。官方的&lt;a href=&#34;https://github.com/cloudfoundry/java-buildpack&#34;&gt;java_buildpack&lt;/a&gt;就提供了制作离线包的功能。Clone下来以后执行如下步骤就制作成功了一个zip包。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
