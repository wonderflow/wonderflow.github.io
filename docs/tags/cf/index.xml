<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cf on 奇迹之流WonderfloW</title>
    <link>https://wonderflow.info/tags/cf/</link>
    <description>Recent content in Cf on 奇迹之流WonderfloW</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 28 Feb 2014 04:14:33 +0000</lastBuildDate>
    <atom:link href="https://wonderflow.info/tags/cf/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Cloud_Controller_NG源码阅读记录</title>
      <link>https://wonderflow.info/posts/2014/02/28/cloud_controller_nge6ba90e7a081e99885e8afbbe8aeb0e5bd95/</link>
      <pubDate>Fri, 28 Feb 2014 04:14:33 +0000</pubDate>
      <guid>https://wonderflow.info/posts/2014/02/28/cloud_controller_nge6ba90e7a081e99885e8afbbe8aeb0e5bd95/</guid>
      <description>&lt;h1 id=&#34;cloud_controller_ng源码阅读记录&#34;&gt;&#xA;    Cloud_Controller_NG源码阅读记录&lt;a class=&#34;hash-link&#34; href=&#34;#cloud_controller_ng%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e8%ae%b0%e5%bd%95&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;@(CC阅读)[cloud controller] by wonderflow&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;Cloud_Controller_NG就是cloud controller next generation的意思。即Cloud Foundry 平台用来管理控制应用和服务的组件。&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;http://docs.cloudfoundry.com/docs/using/terms.html#ccng&#34;&gt;官方文档&lt;/a&gt;是这么解释CCNG的作用的：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;维护一个包含应用、服务、配置信息的数据库(CCDB)。&lt;/li&gt;&#xA;&lt;li&gt;在blobstore中存储应用的packages和droplets。&lt;/li&gt;&#xA;&lt;li&gt;通过NATS和其他组件进行通信，包括Droplet Execution Agents (DEAs)、Service Gateways、和 Health Manager（HM）。&lt;/li&gt;&#xA;&lt;li&gt;其他供用户调用的后端API。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;阅读该组件源码，有助于从应用管理的视角理解cloudfoundry的运行过程。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;说明：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Cloud_Controller_NG以下简称CCNG。&lt;/li&gt;&#xA;&lt;li&gt;本文所阅读的源码版本为github中cf-release中V145 tag下面的CCNG项目源码。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;ccng各模块概览&#34;&gt;&#xA;    CCNG各模块概览&lt;a class=&#34;hash-link&#34; href=&#34;#ccng%e5%90%84%e6%a8%a1%e5%9d%97%e6%a6%82%e8%a7%88&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h1&gt;&lt;p&gt;首先让我们看一下这张框架图：&#xA;&lt;img src=&#34;https://wonderflow.info/images/2014-02-28-cloud_controller_nge6ba90e7a081e99885e8afbbe8aeb0e5bd95/ccng.png&#34; alt=&#34;Alt text&#34;&gt;&#xA;&lt;strong&gt;图1.CCNG架构图byshlallen&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;从ccng架构图中可以看出ccng可以分为以下多个模块：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Stager模块，主要负责与DEA组件的staging部分进行交互；&lt;/li&gt;&#xA;&lt;li&gt;DEA模块，主要负责与DEA组件进行交互；&lt;/li&gt;&#xA;&lt;li&gt;Blobstore模块，主要负责创建一个blobstore的存储，以供Cloud Foundry存储应用所需的静态文件；&lt;/li&gt;&#xA;&lt;li&gt;HealthManager（HM）模块，主要负责与HealthManager组件进行交互；&lt;/li&gt;&#xA;&lt;li&gt;CCDB模块，负责维护cloud_controller的数据库；&lt;/li&gt;&#xA;&lt;li&gt;collector_registrar模块，负责作为component向Collector组件注册；&lt;/li&gt;&#xA;&lt;li&gt;router_registrar模块，负责将cloud controller组件的域名注册至Router组件；&lt;/li&gt;&#xA;&lt;li&gt;legacy_api部分，负责接管ccng关于info，bulk以及services等的RESTful请求；&lt;/li&gt;&#xA;&lt;li&gt;Permission模块，负责各种不同权限用户的注册和认证。&lt;/li&gt;&#xA;&lt;li&gt;其他零散模块&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;我们按官方文档给出的组件功能介绍的顺序逐步深入各模块。&lt;/p&gt;&#xA;&lt;h2 id=&#34;db模块&#34;&gt;&#xA;    DB模块&lt;a class=&#34;hash-link&#34; href=&#34;#db%e6%a8%a1%e5%9d%97&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;众所周知，CCDB就是CC的一个postgresql数据库，用于存储CC需要的一些数据。&lt;/p&gt;&#xA;&lt;p&gt;在CCNG的rakefile里面，有着CCDB建表的初始化信息，具体的建表内容在&lt;code&gt;db/migrations/*.rb&lt;/code&gt;中。&lt;/p&gt;&#xA;&lt;p&gt;CCNG开始正常运行后，主要调用lib/sequel_plugins/update_or_create.rb里面的函数对以下信息的改变进行更新（更新的代码都在以下各部分的源码中，可以使用全文搜索update_or_create函数查看）。&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;framework：语言运行时框架。就是&lt;code&gt;&amp;quot;*.war&amp;quot;&lt;/code&gt;包可上传的各种框架，在&lt;code&gt;/var/vcap/jobs/cloud_controller/config/staging&lt;/code&gt;路径下的各类*.yml存储。@&lt;code&gt;lib/cloud_controller/models/framework.rb&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;stack ：应用运行的堆环境，默认为lucid64。&lt;a href=&#34;http://docs.cloudfoundry.com/docs/running/architecture/stacks.html&#34;&gt;stacks&lt;/a&gt;就是一个预先构建的文件系统，包括可运行应用的操作系统环境。@&lt;code&gt;lib/cloud_controller/models/stack.rb&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;runtime：应用可运行语言的运行时环境。运行时环境的具体信息在配置文件&lt;code&gt;config/runtimes.yml&lt;/code&gt;中。@&lt;code&gt;lib/cloud_controller/models/runtime.rb&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;quota：一些共享信息的更新，包括sevice数量，内存限制等。@&lt;code&gt;lib/cloud_controller/models/quota_definition.rb&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;service：存储支持的service信息。@&lt;code&gt;app/models/services/service_broker.rb&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;blobstore模块&#34;&gt;&#xA;    Blobstore模块&lt;a class=&#34;hash-link&#34; href=&#34;#blobstore%e6%a8%a1%e5%9d%97&#34; title=&#34;Direct link to heading&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;**注：**blobstor相关源码都@&lt;code&gt;lib/cloud_controller/blobstore&lt;/code&gt;文件夹下&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
