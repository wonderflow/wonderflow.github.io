<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Guide for Cloud Foundry New Teamer | 奇迹之流WonderfloW</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="
    Preparation#
1、阅读以下博客：
了解架构，阅读“深入CloudFoundry一周年”
2、请准备好一个linux的客户端，如果没有请申请一个虚拟机，并安装好ubuntu10.04（windows下使用远程连接的方式是使用putty软件。）
3、如果不熟悉linux，请阅读linux相关命令，初步了解。

    Start#


定位cloudfoundry集群： 请使用$ curl [your domain]。若显示出正常信息则初步表面集群配置正确，否则请找帮你配置集群的人。


配置linux源，提高下载速度。(百度一个ubuntu cn的源)


{% codeblock %}
$ /etc/apt/sources.list $ sudo apt-get update
{% endcodeblock %}

安装git，为了下载一个基本应用，github上面的。

{% codeblock %}
$ sudo apt-get install git
{% endcodeblock %}

安装maven，为了打包成war包，期间阅读下maven的功能，不求甚解。

{% codeblock %}
$ sudo apt-get install maven2
{% endcodeblock %}

用git下载cloud foundry基本样例。(请注册github，并百度相关用法，github简单应用 )

{% codeblock %}
$ git clone [http://***.git]
{% endcodeblock %}">
    <meta name="generator" content="Hugo 0.153.4">
    
    
    
      <meta name="robots" content="index, follow">
    
    <meta name="author" content="admin">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css" >



  
    <link rel="stylesheet" href="/css/custom.css">
  


    


    
      
<link rel="shortcut icon" href="/favicon_io/favicon.ico" type="image/x-icon" />


    

    

    
      <link rel="canonical" href="https://wonderflow.info/posts/2013/07/25/guide-for-cloud-foundry-new-teamer-2/">
    

    
    
    <meta property="og:url" content="https://wonderflow.info/posts/2013/07/25/guide-for-cloud-foundry-new-teamer-2/">
  <meta property="og:site_name" content="奇迹之流WonderfloW">
  <meta property="og:title" content="Guide for Cloud Foundry New Teamer">
  <meta property="og:description" content="Preparation# 1、阅读以下博客： 了解架构，阅读“深入CloudFoundry一周年”
2、请准备好一个linux的客户端，如果没有请申请一个虚拟机，并安装好ubuntu10.04（windows下使用远程连接的方式是使用putty软件。）
3、如果不熟悉linux，请阅读linux相关命令，初步了解。
Start# 定位cloudfoundry集群： 请使用$ curl [your domain]。若显示出正常信息则初步表面集群配置正确，否则请找帮你配置集群的人。
配置linux源，提高下载速度。(百度一个ubuntu cn的源)
{% codeblock %} $ /etc/apt/sources.list $ sudo apt-get update {% endcodeblock %}
安装git，为了下载一个基本应用，github上面的。 {% codeblock %} $ sudo apt-get install git {% endcodeblock %}
安装maven，为了打包成war包，期间阅读下maven的功能，不求甚解。 {% codeblock %} $ sudo apt-get install maven2 {% endcodeblock %}
用git下载cloud foundry基本样例。(请注册github，并百度相关用法，github简单应用 ) {% codeblock %} $ git clone [http://***.git] {% endcodeblock %}">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-07-25T05:41:20+00:00">
    <meta property="article:modified_time" content="2013-07-25T05:41:20+00:00">
    <meta property="article:tag" content="Cloudfoundry">
    <meta property="article:tag" content="Ruby">

  <meta itemprop="name" content="Guide for Cloud Foundry New Teamer">
  <meta itemprop="description" content="Preparation# 1、阅读以下博客： 了解架构，阅读“深入CloudFoundry一周年”
2、请准备好一个linux的客户端，如果没有请申请一个虚拟机，并安装好ubuntu10.04（windows下使用远程连接的方式是使用putty软件。）
3、如果不熟悉linux，请阅读linux相关命令，初步了解。
Start# 定位cloudfoundry集群： 请使用$ curl [your domain]。若显示出正常信息则初步表面集群配置正确，否则请找帮你配置集群的人。
配置linux源，提高下载速度。(百度一个ubuntu cn的源)
{% codeblock %} $ /etc/apt/sources.list $ sudo apt-get update {% endcodeblock %}
安装git，为了下载一个基本应用，github上面的。 {% codeblock %} $ sudo apt-get install git {% endcodeblock %}
安装maven，为了打包成war包，期间阅读下maven的功能，不求甚解。 {% codeblock %} $ sudo apt-get install maven2 {% endcodeblock %}
用git下载cloud foundry基本样例。(请注册github，并百度相关用法，github简单应用 ) {% codeblock %} $ git clone [http://***.git] {% endcodeblock %}">
  <meta itemprop="datePublished" content="2013-07-25T05:41:20+00:00">
  <meta itemprop="dateModified" content="2013-07-25T05:41:20+00:00">
  <meta itemprop="wordCount" content="489">
  <meta itemprop="keywords" content="Cloudfoundry,Ruby">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Guide for Cloud Foundry New Teamer">
  <meta name="twitter:description" content="Preparation# 1、阅读以下博客： 了解架构，阅读“深入CloudFoundry一周年”
2、请准备好一个linux的客户端，如果没有请申请一个虚拟机，并安装好ubuntu10.04（windows下使用远程连接的方式是使用putty软件。）
3、如果不熟悉linux，请阅读linux相关命令，初步了解。
Start# 定位cloudfoundry集群： 请使用$ curl [your domain]。若显示出正常信息则初步表面集群配置正确，否则请找帮你配置集群的人。
配置linux源，提高下载速度。(百度一个ubuntu cn的源)
{% codeblock %} $ /etc/apt/sources.list $ sudo apt-get update {% endcodeblock %}
安装git，为了下载一个基本应用，github上面的。 {% codeblock %} $ sudo apt-get install git {% endcodeblock %}
安装maven，为了打包成war包，期间阅读下maven的功能，不求甚解。 {% codeblock %} $ sudo apt-get install maven2 {% endcodeblock %}
用git下载cloud foundry基本样例。(请注册github，并百度相关用法，github简单应用 ) {% codeblock %} $ git clone [http://***.git] {% endcodeblock %}">

      
      
    
	
  </head><body class="ma0 avenir production">

    

  <header>
    <div class="bg-near-white">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        奇迹之流WonderfloW
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/archives/" title="Archives page">
              Archives
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>
    </div>
  </header>


    <main class="pb7" role="main">
      
<div class="flex-l mt2 mw8 center">
  <article class="center cf pv5 ph3 ph4-ns mw7">
    <header>
      <p class="f6 b helvetica tracked">
        POSTS
      </p>
      <h1 class="f1">
        Guide for Cloud Foundry New Teamer
      </h1>
    </header>
    <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
      <h2 id="preparation">
    Preparation<a class="hash-link" href="#preparation" title="Direct link to heading">#</a>
</h2><p>1、阅读以下博客：
了解架构，阅读“<a href="http://qing.blog.sina.com.cn/2294942122/88ca09aa33003k2j.html">深入CloudFoundry一周年</a>”</p>
<p>2、请准备好一个linux的客户端，如果没有请申请一个虚拟机，并安装好ubuntu10.04（windows下使用远程连接的方式是使用putty软件。）</p>
<p>3、如果不熟悉linux，请阅读linux相关命令，初步了解。</p>
<h2 id="start">
    Start<a class="hash-link" href="#start" title="Direct link to heading">#</a>
</h2><ol>
<li>
<p>定位cloudfoundry集群： 请使用$ curl [your domain]。若显示出正常信息则初步表面集群配置正确，否则请找帮你配置集群的人。</p>
</li>
<li>
<p>配置linux源，提高下载速度。(百度一个ubuntu cn的源)</p>
</li>
</ol>
<p>{% codeblock %}
$ /etc/apt/sources.list $ sudo apt-get update
{% endcodeblock %}</p>
<ol>
<li>安装git，为了下载一个基本应用，github上面的。</li>
</ol>
<p>{% codeblock %}
$ sudo apt-get install git
{% endcodeblock %}</p>
<ol>
<li>安装maven，为了打包成war包，期间阅读下maven的功能，不求甚解。</li>
</ol>
<p>{% codeblock %}
$ sudo apt-get install maven2
{% endcodeblock %}</p>
<ol>
<li>用git下载cloud foundry基本样例。(请注册github，并百度相关用法，<a href="https://github.com/wonderflow/cloudfoundry-samples/tree/master/hello-spring-mysql">github简单应用</a> )</li>
</ol>
<p>{% codeblock %}
$ git clone [http://***.git]
{% endcodeblock %}</p>
<ol>
<li>cd到相应根目录，执行maven打包</li>
</ol>
<p>{% codeblock %}
$ mvn clean package
{% endcodeblock %}</p>
<ol>
<li>把war包上传，需要一个干净的目录，里面只有一个war包</li>
</ol>
<p>{% codeblock %}
$ mkdir newdir $ mv *.war newdir/
{% endcodeblock %}</p>
<ol>
<li>在继续下去之前，可能你需要安装ruby以及vmc等相关工具。 ！！建议【安装的版本ruby1.9.3】！！ <a href="http://ruby-china.org/wiki/install_ruby_guide">install_ruby_guide</a>（请一定要有耐心,到了这一部时间极长)</li>
</ol>
<p>{% codeblock %}
$ rvm install 1.9.3 &ndash;with-readline-dir=$rvm_path/usr # 安装 Ruby 1.9.3
{% endcodeblock %}</p>
<p>尤其是出现 it may takes time&hellip;.的时候，要等很久。 但是如果等了很久还是那样就，没关系的。</p>
<p>{% codeblock %}</p>
<p>#安装完后查看下rails包是否正常。
$ gem list #如果是空的，执行
$ rvm use 1.9.3
#然后安装vmc
$ gem install vmc</p>
<p>{% endcodeblock %}</p>
<ol start="9">
<li>按下述执行</li>
</ol>
<p>{% codeblock %}</p>
<p>$ cd [只有war包的目录]
$ vmc target [your domain]
$ vmc register</p>
<blockquote>
<p>emai：　[your_email_address]
password: [your password]
confirm password:[your password]
$ vmc login
emai：　[your_email_address]
password: [your password]
$ vmc push
Name&gt; test1
Instances&gt; 1
1: spring
2: other
Framework&gt; spring
1: java
2: java7
3: other
Runtime&gt; 1
1: 64M
2: 128M
3: 256M
4: 512M
5: 1G
6: 2G
7: 4G
8: 8G
9: 16G
Memory Limit&gt; 512M
Creating spring-mysql&hellip; OK
1: spring-mysql.cf1.load
2: none
Domain&gt; test1.cf.test
[根据给你部署集群的人-配置的不同而不同]
Updating spring-mysql&hellip; OK
Create services for application?&gt; y
Name&gt; mysql-spring
Creating service mysql-spring&hellip; OK</p>
</blockquote>
<p>{% endcodeblock %}</p>
<p>后面的操作全部默认（包括save configuration 选择n也是）</p>
<p>完成后得到一个网址，可以访问。（就是之前给你确定的Domain）</p>
<h2 id="相关资料">
    相关资料<a class="hash-link" href="#%e7%9b%b8%e5%85%b3%e8%b5%84%e6%96%99" title="Direct link to heading">#</a>
</h2><p><a href="http://studiogang.blog.51cto.com/505887/386852">AB test</a>；
<a href="http://blog.csdn.net/yurunsheng/article/details/7978240">示例应用的解析</a>；
<a href="http://blog.csdn.net/dengsilinming/article/details/7516655">vmc的简单说明</a>；
<a href="https://github.com/cloudfoundry/vmc">vmc项目主页</a>；</p>
<h2 id="some-tips-related">
    Some tips related<a class="hash-link" href="#some-tips-related" title="Direct link to heading">#</a>
</h2><h3 id="关于bosh">
    关于BOSH：<a class="hash-link" href="#%e5%85%b3%e4%ba%8ebosh" title="Direct link to heading">#</a>
</h3><p>登陆到bosh，ssh root@[ip address] （you will know the password if you have the authentication）</p>
<p>安装自己相应的配置文件。</p>
<p>{% codeblock %}</p>
<p>$ bosh status #查看配置情况，顺便看到yml配置文件的地址
$ bosh deployment [/[youraddress]/deployments/cf/cf_test_2.yml] #添加自己的配置文件。
$ bosh vms #查看组件整体情况
$ bosh restart XXX #重启某组件</p>
<p>{% endcodeblock %}</p>
<h3 id="rvm管理工具的一些用法">
    rvm管理工具的一些用法。<a class="hash-link" href="#rvm%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7%e7%9a%84%e4%b8%80%e4%ba%9b%e7%94%a8%e6%b3%95" title="Direct link to heading">#</a>
</h3><p>{% codeblock %}</p>
<p>$ bash -l #bash重启
$ rvm use 1.9.2 #使用某个版本
$ rvm 1.9.2 &ndash;default
$ gem list #查看gem包
$ gem -v
$ ruby -v #查看当前使用的版本</p>
<p>{% endcodeblock %}</p>
<p>Gem卸载、安装相关，以vmc为例。</p>
<p>先卸载当前版本，再安装0.5.1版本</p>
<p>{% codeblock %}</p>
<p>$ gem uninstall vmc
$ gem install vmc &ndash;version=0.5.1 检查nameserver是否正常。
$ vim /etc/resolv.conf</p>
<p>{% endcodeblock %}</p>
<p>vmc登录出现一些问题，使用-t选项，可以看到cloudcontroller里面的代码。</p>
<p>{% codeblock %}</p>
<p>$ vmc register -t #可以看到cloudcontroller里面相关代码。 #登录到集群cloudcontroller相关模块查看cloudcontroller 的yml文件。
$ ssh [root@10.10.102.165] #请使用你自己集群cloudcontroller的文件
$ vi /var/vcap/jobs/cloud_controller/config/cloud_controller.yml #之前遇到一个https不能使用的问题，改成http即可。</p>
<p>{% endcodeblock %}</p>
<p><strong>others：you may ask the guys nearby，if you are clever, they will glad to help you。</strong></p>
<h2 id="learn-ruby">
    Learn Ruby<a class="hash-link" href="#learn-ruby" title="Direct link to heading">#</a>
</h2><p>一、 阅读一本ruby语言的相关电子书，建立初步概念，网上很多。
<a href="http://ishare.iask.sina.com.cn/f/23034819.html">《Ruby从入门到精通》</a> <a href="http://wenku.baidu.com/view/dd769633a32d7375a4178059.html">《Ruby语言入门教程》</a></p>
<p>二、如果有脚本语言的基础，阅读：<a href="http://www.btsmth.com/show_topic.php?en_name=Programming&amp;gid=156911">“快速读懂ruby代码问答”</a></p>
<p>三、 看别人高手写的小代码，<a href="http://codeforces.com/">Codeforces</a></p>
<p>四、Cloud Foundry 源码：<a href="https://github.com/cloudfoundry">@github</a></p>
<h2 id="components-list">
    Components List<a class="hash-link" href="#components-list" title="Direct link to heading">#</a>
</h2><p><strong>LB</strong>（load balance）:负载均衡器，对进来的url请求进行负载均衡的分发，分发到Router，使用nginx。</p>
<p><strong>Router</strong>：对所有进来的Request进行路由，包括nginx和router两个组件。目前使用的nginx是带LUA语言扩展的第二版，它里面加入了url查询和统计逻辑。处理了原来ruby写脚本处理转发的瓶颈。从架构图上可以看出，从router路由出去的数据，很大一部分是流向了DEA，还有一部分则是流向了CloudController组件。</p>
<p><strong>DEA</strong> （Droplet Execution Agent）:它负责把上传的应用制作并存储成CloudFoundry能使用的Droplet，在应用开始执行后，dea把droplet 复制成很多份实例去运行。同时它还进行一个对应用程序的容器作用，承载应用程序在其中孤立运行，对系统进行保护。最后它给router一个信息让应用对应的request访问到这里。</p>
<p><strong>CC</strong> （Cloud Controller）： Cloud Controller是CloudFoundry的管理模块。主要工作包括： a) 对apps的增删改读； b) 启动、停止应用程序（通过DEA）； c) Stagingapps（把apps打包成一个droplet，通过Stager）； d) 修改应用程序运行环境，包括instance、mem等等； e) 管理service，包括service与app的绑定等； f) Cloud环境的管理； g) 修改Cloud的用户信息（通过UAA，ACM）； h) 查看CloudFoundry，以及每一个app的log信息。</p>
<p><strong>CCDB</strong> （CloudController Database）：cc的数据库，用来存储用户的应用信息，在启动应用与创建instance的时候会用到。</p>
<p><strong>UAA</strong>（User Account and Authentication）：是一个用户认证的模块，负责验证用户的信息。</p>
<p><strong>UAADB</strong>（User Account and Authentication Database）：uaa的数据库，用来存储用户的信息，同样在登陆的过程中可以测试。</p>
<p><strong>Health Manager</strong>: 从各个DEA里面拿到运行信息，然后进行统计分析，报告等。统计数据会与CloudController的设定指标进行比对，并提供Alert等。这些信息会发送到dashboard显示出来。</p>
<p><strong>Service</strong>：这个模块是很多个服务的合集，由多个节点共同构成，包括所有支持的数据库等。 『mongodb，mysql ，postgresql ，rabbit ，redis ，service_gateway』
大致服务流程如下：
a) 开发人员通过VMC创建一个Service;
b) VMC把其转为Restful接口到CloudController；
c) CloudController通过Restful接口发送创建命令到Service Gateway；
d) ServiceGateway通过NATS发送provision命令道Service Node； e) ServiceNode创建Service；
f) Service Node把返回创建的Service访问方法回Service Gateway；
g) ServiceGateway返回访问方法到CloudController；
h) CloudController把创建的Service访问放法注入到应用运行环境；
i) 最终用户可以直接访问其服务。</p>
<p><strong>NATS</strong> (Message bus)：CloudFoundry的架构是基于消息发布与订阅的，联系各模块的就是nats的组件。也就是说它是cloudfoundry的神经系统。 所以nats是一款基于EventMachine、使用“发布&ndash;订阅”机制的轻量级消息中间件。 『CloudFoundry作为一个弹性设计的，多模块的分布式系统，且支持模块自发现，错误自检，保证模块间低耦合。其根本原理就是基于消息发布订阅机制构建。每台服务器上的每个模块会根据自己的消息类别，向Message Bus发布多个消息主题；而同时也向自己需要交互的模块，按照需要的信息内容的消息主题订阅消息。』</p>
<p><strong>Dashboard</strong>: 用于显示系统内部各情况的板报。</p>
<p><strong>Opentsdb</strong>: 负责存储dashboard所要显示各类信息的数据库。</p>
<p><strong>Collector</strong>: a) 发现各组件，创建varz信息（组件的各种信息，随组件的不同提供的信息也不同） b) 收集各组件提供的varz信息 c) 处理varz信息并存储到spentsdb</p>
<p><strong>Learn More by Yourself</strong>:
<a href="http://group.google.com">http://group.google.com</a> 【bosh-users】 【cloudfoundry】 and so on</p>
<p>——Sun Jianbo 2013年7月25日</p>

    </div>
  </article>
</div>

    </main>
    <footer class="bg-near-white bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
    <a class="f4 fw4 hover-black no-underline mid-gray dn dib-ns pv2 ph3" href="https://wonderflow.info/">
      &copy;  奇迹之流WonderfloW 2025 
    </a>
    <div><div class="ananke-socials"></div>
</div>
    <a href="https://beian.miit.gov.cn/" class="link db f6 pa2 br3 bg-mid-gray white dim w4 tc"> 沪ICP备2020029591号 </a>
    
  </div>
</footer>


<div class="reading-progress" id="reading-progress"></div>


<button class="back-to-top" id="back-to-top" aria-label="Back to top">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="18 15 12 9 6 15"></polyline>
  </svg>
</button>


<script>
(function() {
  
  const progressBar = document.getElementById('reading-progress');
  const backToTop = document.getElementById('back-to-top');

  function updateProgress() {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;

    if (progressBar) {
      progressBar.style.width = progress + '%';
    }

    
    if (backToTop) {
      if (scrollTop > 300) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }
    }
  }

  
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        updateProgress();
        ticking = false;
      });
      ticking = true;
    }
  });

  
  if (backToTop) {
    backToTop.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  
  updateProgress();
})();
</script>

  </body>
</html>
