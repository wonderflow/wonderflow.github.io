<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>CUE 基础入门 | 奇迹之流WonderfloW</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="磨刀不误砍柴工，在正式开始介绍 CUE 之前，可以先做下基本的准备工作。

安装：首先确保你已经安装了 cuelang： https://cuelang.org/docs/install/
自动格式化：如果你使用 Goland 或者类似的 JetBrains IDE，还可以额外配置自动格式化的方式：https://wonderflow.info/posts/2020-11-02-goland-cuelang-format/


    基本操作#
先看一下cuelang的基本数据样子。
a: 1.5
b: 1
d: [1, 2, 3]
g: {
	h: &#34;abc&#34;
}
我们把上面的内容写入到文件并命名为 &ldquo;first.cue&rdquo;.

格式化 cuelang 的文件

cue fmt first.cue

校验写法是否正确

cue vet first.cue

计算输出结果

cue eval first.cue

计算输出单个变量的结果

cue eval -e a first.cue

数据导出（默认为json）

cue export first.cue

指定 yaml 格式导出

cue export first.cue --out yaml

导出某个变量

cue export first.cue -e a --out yaml

    类型 与  “集合” 式编程#
在熟悉了 cuelang 基本操作以后，我们来看下它的常用类型和写法。">
    <meta name="generator" content="Hugo 0.153.4">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css" >



  
    <link rel="stylesheet" href="/css/custom.css">
  


    


    
      
<link rel="shortcut icon" href="/favicon_io/favicon.ico" type="image/x-icon" />


    

    

    
      <link rel="canonical" href="https://wonderflow.info/posts/2020-12-15-cuelang-template/">
    

    
    
    <meta property="og:url" content="https://wonderflow.info/posts/2020-12-15-cuelang-template/">
  <meta property="og:site_name" content="奇迹之流WonderfloW">
  <meta property="og:title" content="CUE 基础入门">
  <meta property="og:description" content="磨刀不误砍柴工，在正式开始介绍 CUE 之前，可以先做下基本的准备工作。
安装：首先确保你已经安装了 cuelang： https://cuelang.org/docs/install/ 自动格式化：如果你使用 Goland 或者类似的 JetBrains IDE，还可以额外配置自动格式化的方式：https://wonderflow.info/posts/2020-11-02-goland-cuelang-format/ 基本操作# 先看一下cuelang的基本数据样子。
a: 1.5 b: 1 d: [1, 2, 3] g: { h: &#34;abc&#34; } 我们把上面的内容写入到文件并命名为 “first.cue”.
格式化 cuelang 的文件 cue fmt first.cue 校验写法是否正确 cue vet first.cue 计算输出结果 cue eval first.cue 计算输出单个变量的结果 cue eval -e a first.cue 数据导出（默认为json） cue export first.cue 指定 yaml 格式导出 cue export first.cue --out yaml 导出某个变量 cue export first.cue -e a --out yaml 类型 与 “集合” 式编程# 在熟悉了 cuelang 基本操作以后，我们来看下它的常用类型和写法。">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-12-15T14:21:16+08:00">
    <meta property="article:modified_time" content="2020-12-15T14:21:16+08:00">

  <meta itemprop="name" content="CUE 基础入门">
  <meta itemprop="description" content="磨刀不误砍柴工，在正式开始介绍 CUE 之前，可以先做下基本的准备工作。
安装：首先确保你已经安装了 cuelang： https://cuelang.org/docs/install/ 自动格式化：如果你使用 Goland 或者类似的 JetBrains IDE，还可以额外配置自动格式化的方式：https://wonderflow.info/posts/2020-11-02-goland-cuelang-format/ 基本操作# 先看一下cuelang的基本数据样子。
a: 1.5 b: 1 d: [1, 2, 3] g: { h: &#34;abc&#34; } 我们把上面的内容写入到文件并命名为 “first.cue”.
格式化 cuelang 的文件 cue fmt first.cue 校验写法是否正确 cue vet first.cue 计算输出结果 cue eval first.cue 计算输出单个变量的结果 cue eval -e a first.cue 数据导出（默认为json） cue export first.cue 指定 yaml 格式导出 cue export first.cue --out yaml 导出某个变量 cue export first.cue -e a --out yaml 类型 与 “集合” 式编程# 在熟悉了 cuelang 基本操作以后，我们来看下它的常用类型和写法。">
  <meta itemprop="datePublished" content="2020-12-15T14:21:16+08:00">
  <meta itemprop="dateModified" content="2020-12-15T14:21:16+08:00">
  <meta itemprop="wordCount" content="511">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="CUE 基础入门">
  <meta name="twitter:description" content="磨刀不误砍柴工，在正式开始介绍 CUE 之前，可以先做下基本的准备工作。
安装：首先确保你已经安装了 cuelang： https://cuelang.org/docs/install/ 自动格式化：如果你使用 Goland 或者类似的 JetBrains IDE，还可以额外配置自动格式化的方式：https://wonderflow.info/posts/2020-11-02-goland-cuelang-format/ 基本操作# 先看一下cuelang的基本数据样子。
a: 1.5 b: 1 d: [1, 2, 3] g: { h: &#34;abc&#34; } 我们把上面的内容写入到文件并命名为 “first.cue”.
格式化 cuelang 的文件 cue fmt first.cue 校验写法是否正确 cue vet first.cue 计算输出结果 cue eval first.cue 计算输出单个变量的结果 cue eval -e a first.cue 数据导出（默认为json） cue export first.cue 指定 yaml 格式导出 cue export first.cue --out yaml 导出某个变量 cue export first.cue -e a --out yaml 类型 与 “集合” 式编程# 在熟悉了 cuelang 基本操作以后，我们来看下它的常用类型和写法。">

      
      
    
	
  </head><body class="ma0 avenir production">

    

  <header>
    <div class="bg-near-white">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        奇迹之流WonderfloW
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/archives/" title="Archives page">
              Archives
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>
    </div>
  </header>


    <main class="pb7" role="main">
      
<div class="flex-l mt2 mw8 center">
  <article class="center cf pv5 ph3 ph4-ns mw7">
    <header>
      <p class="f6 b helvetica tracked">
        POSTS
      </p>
      <h1 class="f1">
        CUE 基础入门
      </h1>
    </header>
    <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
      <p>磨刀不误砍柴工，在正式开始介绍 CUE 之前，可以先做下基本的准备工作。</p>
<ul>
<li>安装：首先确保你已经安装了 cuelang： <a href="https://cuelang.org/docs/install/">https://cuelang.org/docs/install/</a></li>
<li>自动格式化：如果你使用 Goland 或者类似的 JetBrains IDE，还可以额外配置自动格式化的方式：https://wonderflow.info/posts/2020-11-02-goland-cuelang-format/</li>
</ul>
<h2 id="基本操作">
    基本操作<a class="hash-link" href="#%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c" title="Direct link to heading">#</a>
</h2><p>先看一下cuelang的基本数据样子。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: 1.5
</span></span><span style="display:flex;"><span>b: 1
</span></span><span style="display:flex;"><span>d: [1, 2, 3]
</span></span><span style="display:flex;"><span>g: {
</span></span><span style="display:flex;"><span>	h: &#34;abc&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们把上面的内容写入到文件并命名为 &ldquo;first.cue&rdquo;.</p>
<ul>
<li>格式化 cuelang 的文件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cue fmt first.cue
</span></span></code></pre></div><ul>
<li>校验写法是否正确</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cue vet first.cue
</span></span></code></pre></div><ul>
<li>计算输出结果</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cue eval first.cue
</span></span></code></pre></div><ul>
<li>计算输出单个变量的结果</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cue eval -e a first.cue
</span></span></code></pre></div><ul>
<li>数据导出（默认为json）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue
</span></span></code></pre></div><ul>
<li>指定 yaml 格式导出</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue <span style="color:#0550ae">--</span>out yaml
</span></span></code></pre></div><ul>
<li>导出某个变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue <span style="color:#0550ae">-</span>e a <span style="color:#0550ae">--</span>out yaml
</span></span></code></pre></div><h2 id="类型-与--集合-式编程">
    类型 与  “集合” 式编程<a class="hash-link" href="#%e7%b1%bb%e5%9e%8b-%e4%b8%8e--%e9%9b%86%e5%90%88-%e5%bc%8f%e7%bc%96%e7%a8%8b" title="Direct link to heading">#</a>
</h2><p>在熟悉了 cuelang 基本操作以后，我们来看下它的常用类型和写法。</p>
<p>你可以直接定义一个“schema”，如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: float
</span></span></code></pre></div><p>也可以直接写“data”：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// 浮点型
</span></span><span style="display:flex;"><span>a: 1.5
</span></span></code></pre></div><p>可以看到 cuelang 里面“数据data”和“定义schema”的写法是一样的。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: float
</span></span><span style="display:flex;"><span>a: 1.5
</span></span></code></pre></div><p>把两个文件写到一起，然后计算下最后的结果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ cue eval first.cue 
</span></span><span style="display:flex;"><span>a: 1.5
</span></span></code></pre></div><p>可以看到变量 <code>a</code> 的结果就确定下来是 1.5 。</p>
<p>这个过程的本质是两个集合做了一个“相交”的操作。 第一个集合 <code>a: float</code> 代表了 a 是所有浮点数。 第二个集合 <code>a: 1.5</code> 则把 a 这个变量的值缩小到只剩下一个确定的值 <code>1.5</code>. 所以最后的结果是 <code>1.5</code>.</p>
<p>我们可以改成别的类型试试:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: string
</span></span><span style="display:flex;"><span>a: float
</span></span></code></pre></div><p>再运行一下计算：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ cue eval first.cue
</span></span><span style="display:flex;"><span>a: conflicting values string and 1.5 (mismatched types string and float):
</span></span><span style="display:flex;"><span>    ./first.cue:1:4
</span></span><span style="display:flex;"><span>    ./first.cue:2:4
</span></span></code></pre></div><p>所以cuelang里面的计算实际上就是不断在做集合相交，把结果集不断缩小。如果最后两个集合相交没有任何结果，用 <code>_|_</code>表示（空集合）。</p>
<p>除了上述的几个例子以外，cuelang 的常用数据类型还包括：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// 浮点型
</span></span><span style="display:flex;"><span>a: 1.5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// 整型
</span></span><span style="display:flex;"><span>b: 1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// 字符串类型
</span></span><span style="display:flex;"><span>c: &#34;blahblahblah&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// 数组
</span></span><span style="display:flex;"><span>d: [1, 2, 3, 1, 2, 3, 1, 2, 3]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Bool 型
</span></span><span style="display:flex;"><span>e: true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// 结构体类型
</span></span><span style="display:flex;"><span>f: {
</span></span><span style="display:flex;"><span>	a: 1.5
</span></span><span style="display:flex;"><span>	b: 1
</span></span><span style="display:flex;"><span>	d: [1, 2, 3, 1, 2, 3, 1, 2, 3]
</span></span><span style="display:flex;"><span>	g: {
</span></span><span style="display:flex;"><span>		h: &#34;abc&#34;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// null
</span></span><span style="display:flex;"><span>j: null
</span></span></code></pre></div><p>也可以用<code>#</code>符号明确指定一个类型：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#a: string
</span></span><span style="display:flex;"><span>a: 1.2
</span></span></code></pre></div><p>这里指定的 <code>#a</code> 是明确为一种类型，计算时并不会输出结果，与变量 <code>a</code> 也没有任何关系:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#0550ae">$</span> cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;a&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">1.2</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><h2 id="操作符">
    操作符<a class="hash-link" href="#%e6%93%8d%e4%bd%9c%e7%ac%a6" title="Direct link to heading">#</a>
</h2><h3 id="或操作">
    “或”操作<a class="hash-link" href="#%e6%88%96%e6%93%8d%e4%bd%9c" title="Direct link to heading">#</a>
</h3><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: 1 | 2
</span></span></code></pre></div><p>表示 a 的值既可以是 1，也可以是 2.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: string | int
</span></span></code></pre></div><p>表示 a 的值是 string 或者 int 类型。</p>
<h3 id="默认值">
    “默认值”<a class="hash-link" href="#%e9%bb%98%e8%ae%a4%e5%80%bc" title="Direct link to heading">#</a>
</h3><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: *1 | int
</span></span></code></pre></div><p>把 <code>*</code> 放在具体的数值前面表示默认值，通常情况默认值要和“或操作” 一起使用，表示 a 是 int 类型，默认值是 1.</p>
<h3 id="可缺省参数">
    “可缺省”参数<a class="hash-link" href="#%e5%8f%af%e7%bc%ba%e7%9c%81%e5%8f%82%e6%95%b0" title="Direct link to heading">#</a>
</h3><p>还有一种特殊的情况是默认可以不存在（即“可缺省”）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a ?: int
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>my: {
</span></span><span style="display:flex;"><span>  x ?: string
</span></span><span style="display:flex;"><span>  y : int
</span></span><span style="display:flex;"><span>  z ?:float
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="与操作">
    “与”操作<a class="hash-link" href="#%e4%b8%8e%e6%93%8d%e4%bd%9c" title="Direct link to heading">#</a>
</h3><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>a: *1 | int
</span></span><span style="display:flex;"><span>b: 3
</span></span><span style="display:flex;"><span>c: a &amp; b
</span></span></code></pre></div><p>将 a 和 b 两个集合相交就是 用 <code>&amp;</code> 操作符。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ cue eval first.cue
</span></span><span style="display:flex;"><span>a: 1
</span></span><span style="display:flex;"><span>b: 3
</span></span><span style="display:flex;"><span>c: 3
</span></span></code></pre></div><h3 id="条件判断">
    条件判断<a class="hash-link" href="#%e6%9d%a1%e4%bb%b6%e5%88%a4%e6%96%ad" title="Direct link to heading">#</a>
</h3><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>price: number
</span></span><span style="display:flex;"><span>feel: *&#34;good&#34; | string
</span></span><span style="display:flex;"><span>// Feel bad if price is too high
</span></span><span style="display:flex;"><span>if price &gt; 100 {
</span></span><span style="display:flex;"><span>    feel: &#34;bad&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>price: 200
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ cue eval first.cue
</span></span><span style="display:flex;"><span>price: 200
</span></span><span style="display:flex;"><span>feel:  &#34;bad&#34;
</span></span></code></pre></div><h3 id="循环">
    循环<a class="hash-link" href="#%e5%be%aa%e7%8e%af" title="Direct link to heading">#</a>
</h3><div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#a: {
</span></span><span style="display:flex;"><span>	&#34;hello&#34;: &#34;Barcelona&#34;
</span></span><span style="display:flex;"><span>	&#34;nihao&#34;: &#34;Shanghai&#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>for k, v in #a {
</span></span><span style="display:flex;"><span>	&#34;\(k)&#34;: {
</span></span><span style="display:flex;"><span>		nameLen: len(v)
</span></span><span style="display:flex;"><span>		value:   v
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>除了循环的用法外，这里用 双引号 和 括号 （<code>&quot;\(k)&quot;</code>）来做了个内部的计算和字符串转换，还用到了一个计算字符串长度的cuelang内置函数 <code>len</code>。这些内置的内容不用深究，可以后续深入了解时再学习。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#0550ae">$</span> cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue
</span></span><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;hello&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;nameLen&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">9</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;value&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Barcelona&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;nihao&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;nameLen&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">8</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;value&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;Shanghai&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><h2 id="变量引用与模板">
    变量引用与模板<a class="hash-link" href="#%e5%8f%98%e9%87%8f%e5%bc%95%e7%94%a8%e4%b8%8e%e6%a8%a1%e6%9d%bf" title="Direct link to heading">#</a>
</h2><p>至此，我们对cuelang的类型和各种操作基本有了完整的认识，我们来试着使用上面学到的内容，试着构建一个实际的模板。</p>
<ol>
<li>定义一个结构体类型，包含2个字符串成员。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#Config: {
</span></span><span style="display:flex;"><span>	name:  string
</span></span><span style="display:flex;"><span>	value: string
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="2">
<li>申明一个 context 变量，其中一个是字符串成员，另外一个是数组，数组中的元素则使用在第一步中定义的结构体类型<code>#Config</code>。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>parameter: {
</span></span><span style="display:flex;"><span>	name: string
</span></span><span style="display:flex;"><span>	image: string
</span></span><span style="display:flex;"><span>	config: [...#Config]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="3">
<li>定义一个模板，使用上面的 context 变量。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>template: {
</span></span><span style="display:flex;"><span>	apiVersion: &#34;apps/v1&#34;
</span></span><span style="display:flex;"><span>	kind:       &#34;Deployment&#34;
</span></span><span style="display:flex;"><span>	spec: {
</span></span><span style="display:flex;"><span>		selector: matchLabels: {
</span></span><span style="display:flex;"><span>			&#34;app.oam.dev/component&#34;: parameter.name
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		template: {
</span></span><span style="display:flex;"><span>			metadata: labels: {
</span></span><span style="display:flex;"><span>				&#34;app.oam.dev/component&#34;: parameter.name
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			spec: {
</span></span><span style="display:flex;"><span>				containers: [{
</span></span><span style="display:flex;"><span>					name:  parameter.name
</span></span><span style="display:flex;"><span>					image: parameter.image
</span></span><span style="display:flex;"><span>					if context[&#34;config&#34;] != _|_ {
</span></span><span style="display:flex;"><span>						env: parameter.config
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>				}]
</span></span><span style="display:flex;"><span>			}}}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="4">
<li>熟悉 K8s 的朋友可能已经发现，上面模板有点像 K8s 的Deployment。实际上这个就是一个 K8s Deployment 的模板。而模板中可替换的部分就是在 parameter 中的内容。让我们来为 parameter 赋值。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>parameter:{
</span></span><span style="display:flex;"><span>   name: &#34;mytest&#34;
</span></span><span style="display:flex;"><span>   image: &#34;nginx:v1&#34;
</span></span><span style="display:flex;"><span>   config:[{name:&#34;a&#34;,value:&#34;b&#34;}]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="5">
<li><strong>让我们依次把1~4步中的内容粘贴到一个cue文件中去，然后执行</strong>：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#0550ae">$</span> cue <span style="color:#cf222e">export</span> first<span style="color:#0550ae">.</span>cue <span style="color:#0550ae">-</span>e template <span style="color:#0550ae">--</span>out yaml
</span></span><span style="display:flex;"><span>apiVersion<span style="color:#1f2328">:</span> apps<span style="color:#0550ae">/</span>v1
</span></span><span style="display:flex;"><span>kind<span style="color:#1f2328">:</span> Deployment
</span></span><span style="display:flex;"><span>spec<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>  template<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    spec<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>      containers<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#0550ae">-</span> name<span style="color:#1f2328">:</span> mytest
</span></span><span style="display:flex;"><span>        env<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0550ae">-</span> name<span style="color:#1f2328">:</span> a
</span></span><span style="display:flex;"><span>          value<span style="color:#1f2328">:</span> b
</span></span><span style="display:flex;"><span>        image<span style="color:#1f2328">:</span> nginx<span style="color:#1f2328">:</span>v1
</span></span><span style="display:flex;"><span>    metadata<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>      labels<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        app<span style="color:#0550ae">.</span>oam<span style="color:#0550ae">.</span>dev<span style="color:#0550ae">/</span>component<span style="color:#1f2328">:</span> mytest
</span></span><span style="display:flex;"><span>  selector<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    matchLabels<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>      app<span style="color:#0550ae">.</span>oam<span style="color:#0550ae">.</span>dev<span style="color:#0550ae">/</span>component<span style="color:#1f2328">:</span> mytest
</span></span></code></pre></div><p>一个完整的 K8s deployment yaml 已经出现。</p>
<p>至此，我们已经学会了一些 cuelang 的基本用法并试着编写了一个Deployment模板。</p>

    </div>
  </article>
</div>

    </main>
    <footer class="bg-near-white bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
    <a class="f4 fw4 hover-black no-underline mid-gray dn dib-ns pv2 ph3" href="https://wonderflow.info/">
      &copy;  奇迹之流WonderfloW 2025 
    </a>
    <div><div class="ananke-socials"></div>
</div>
    <a href="https://beian.miit.gov.cn/" class="link db f6 pa2 br3 bg-mid-gray white dim w4 tc"> 沪ICP备2020029591号 </a>
    
  </div>
</footer>


<div class="reading-progress" id="reading-progress"></div>


<button class="back-to-top" id="back-to-top" aria-label="Back to top">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="18 15 12 9 6 15"></polyline>
  </svg>
</button>


<script>
(function() {
  
  const progressBar = document.getElementById('reading-progress');
  const backToTop = document.getElementById('back-to-top');

  function updateProgress() {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;

    if (progressBar) {
      progressBar.style.width = progress + '%';
    }

    
    if (backToTop) {
      if (scrollTop > 300) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }
    }
  }

  
  let ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        updateProgress();
        ticking = false;
      });
      ticking = true;
    }
  });

  
  if (backToTop) {
    backToTop.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  
  updateProgress();
})();
</script>

  </body>
</html>
